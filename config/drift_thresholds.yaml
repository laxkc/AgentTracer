# Phase 3 - Drift Detection Thresholds Configuration
#
# This file defines thresholds for drift detection.
# All thresholds are configurable and can be tuned based on user needs.
#
# Design Philosophy:
# - Thresholds are explicit (no "magic numbers")
# - Drift detection is statistical, not heuristic
# - Severity is based on magnitude, not quality judgment

# Decision Drift Thresholds
# Applied to decision distribution changes (tool_selection, retry_strategy, etc.)
decision_drift:
  # Statistical significance threshold (p-value from Chi-square test)
  # Lower p-value = more confident the distributions differ
  # Default: 0.05 (95% confidence)
  p_value_threshold: 0.05

  # Minimum percent change to consider as drift
  # Filters out noise from very small changes
  # Default: 10% (a 10% change in distribution is considered drift)
  min_delta_percent: 10.0

  # Test method (currently only chi_square supported)
  test_method: "chi_square"

# Signal Drift Thresholds
# Applied to quality signal distribution changes (schema_valid, tool_success, etc.)
signal_drift:
  # Statistical significance threshold (p-value from Chi-square test)
  p_value_threshold: 0.05

  # Minimum percent change to consider as drift
  # Slightly higher than decision drift (signals can be more volatile)
  # Default: 15%
  min_delta_percent: 15.0

  # Test method
  test_method: "chi_square"

# Latency Drift Thresholds
# Applied to latency statistic changes (mean, p95, p99 duration)
latency_drift:
  # Minimum percent change to consider as drift
  # Latency is more variable, so higher threshold
  # Default: 20%
  min_delta_percent: 20.0

  # Test method (simple percent threshold, no statistical test)
  test_method: "percent_threshold"

# Severity Thresholds
# Severity is based purely on magnitude of change, not quality judgment
# Severity helps prioritize investigation, not judge correctness
severity_thresholds:
  # Low severity: up to 15% change
  low:
    max_delta_percent: 15.0

  # Medium severity: 15-30% change
  medium:
    max_delta_percent: 30.0

  # High severity: >30% change
  # (no max defined - anything above medium threshold is high)

# Minimum Sample Sizes
# Minimum number of runs required for valid profiles and drift detection
minimum_sample_sizes:
  # Minimum runs to build a valid behavior profile
  profile: 100

  # Minimum runs for drift detection comparison
  drift_detection: 50

# Notes on Tuning:
#
# 1. p_value_threshold:
#    - Lower (e.g., 0.01) = more strict, fewer false positives, may miss real drift
#    - Higher (e.g., 0.10) = more sensitive, more drift detected, more false positives
#
# 2. min_delta_percent:
#    - Lower (e.g., 5%) = detect smaller changes, more alerts
#    - Higher (e.g., 20%) = only detect larger changes, fewer alerts
#
# 3. severity_thresholds:
#    - Adjust based on your tolerance for change
#    - Example: In stable production, 10% might be "high"
#    - Example: In experimental environments, 30% might be "medium"
#
# 4. minimum_sample_sizes:
#    - Higher = more statistical confidence, longer time to detect drift
#    - Lower = faster detection, less statistical confidence
#
# Recommended approach:
# - Start with defaults
# - Monitor alert volume and false positive rate
# - Tune thresholds based on your specific use case
# - Different agents may need different thresholds (future enhancement)
